
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><title>request delay benchmark</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<style type="text/css">

body
{
color: gray;
background-color: #202020;
font-family: arial, helvetica, verdana, tahoma, sans-serif;
}
#results
{
	width:90%;
	letter-spacing:-.1em;
}


</style>
</head>



<body><div>

	

	<h2>ReqSpeed (beta) </h2><br/>
	by Cory Salvesen<br/><br/>
	This tool measures the latency for http requests. Refresh the page to stop/reset<br/><br/>



	<div id="buttons">  	 <button onmouseup="continuousstatic()">Start Test</button>
	</div>
<div id="rtping"></div>
<div id="results"></div>
<canvas id="myCanvas" width="600" height="197" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>
<ul id=""></ul>
<div id="afterresults1"></div>
<div id="afterresults2"></div>

<script type="text/javascript">
<!--

	var counter1 = 0;
	var total1 = 0;
	var starttime = 0;
	var string1 = "";
	var min = 50000;
	var max = 0;
	var xhr = new XHConn();
	var results1;
	var c = document.getElementById("myCanvas");
	var ctx = c.getContext("2d");
	ctx.font = "10px Arial";
	var textX = 0;
	var textY = 10;
	var paused = false;


var colormap = new Array (1501);
for(x=1;x<1500;x++)
{
	colormap[x] = numberToColorHsl(Math.round((100-((Math.log(x)/6)*100)))+30);
}


function colorof(num)
{
//	alert(colormap[1499]);
//	if (counter1 % 100 == 0)
//		return colormap[1499];
	if(num>1499)
		return colormap[1499];
	return colormap[num];
}

/**
 * http://stackoverflow.com/questions/2353211/hsl-to-rgb-color-conversion
 *
 * Converts an HSL color value to RGB. Conversion formula
 * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
 * Assumes h, s, and l are contained in the set [0, 1] and
 * returns r, g, and b in the set [0, 255].
 *
 * @param   Number  h       The hue
 * @param   Number  s       The saturation
 * @param   Number  l       The lightness
 * @return  Array           The RGB representation
 */

function hslToRgb(h, s, l){
    var r, g, b;

    if(s == 0){
        r = g = b = l; // achromatic
    }else{
        function hue2rgb(p, q, t){
            if(t < 0) t += 1;
            if(t > 1) t -= 1;
            if(t < 1/6) return p + (q - p) * 6 * t;
            if(t < 1/2) return q;
            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        }

        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        var p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
    }

    return [Math.floor(r * 255), Math.floor(g * 255), Math.floor(b * 255)];
}

// convert a number to a color using hsl
function numberToColorHsl(i) {
    // as the function expects a value between 0 and 1, and red = 0� and green = 120�
    // we convert the input to the appropriate hue value
    var hue = i * (1.2 / 360);
    // we convert hsl to rgb (saturation 100%, lightness 50%)
    var rgb = hslToRgb(hue, 1, .5);
    // we format to css value and return
    return 'rgb(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ')'; 
}



/** XHConn - Simple XMLHTTP Interface - bfults@gmail.com - 2005-04-08        **
 ** Code licensed under Creative Commons Attribution-ShareAlike License      **
 ** http://creativecommons.org/licenses/by-sa/2.0/                           **/
function XHConn()
{
  var xmlhttp, bComplete = false;
  try { xmlhttp = new ActiveXObject("Msxml2.XMLHTTP"); }
  catch (e) { try { xmlhttp = new ActiveXObject("Microsoft.XMLHTTP"); }
  catch (e) { try { xmlhttp = new XMLHttpRequest(); }
  catch (e) { xmlhttp = false; }}}
  if (!xmlhttp) return null;
  this.connect = function(sURL, sMethod, sVars, fnDone)
  {
    if (!xmlhttp) return false;
    bComplete = false;
    sMethod = sMethod.toUpperCase();

    try {
      if (sMethod == "GET")
      {
        xmlhttp.open(sMethod, sURL+"?"+sVars, true);
        sVars = "";
      }
      else
      {
        xmlhttp.open(sMethod, sURL, true);
        xmlhttp.setRequestHeader("Method", "POST "+sURL+" HTTP/1.1");
        xmlhttp.setRequestHeader("Content-Type",
          "application/x-www-form-urlencoded");
      }
      xmlhttp.onreadystatechange = function(){
        if (xmlhttp.readyState == 4 && !bComplete)
        {
          bComplete = true;
          fnDone(xmlhttp);
        }};
      xmlhttp.send(sVars);
    }
    catch(z) { return false; }
    return true;
  };
  return this;
}

	function pausetest()
	{
		buttondiv = document.getElementById("buttons");
		buttondiv.innerHTML = '<button onmouseup="continuousstatic()">Start Test</button>';
		paused = true;

	}

	function continuousstatic()
	{
		paused = false;
		buttondiv = document.getElementById("buttons");
		buttondiv.innerHTML = '<button onmouseup="pausetest()">Pause</button>';
		var url = "nocache=" + Math.random() ;

		starttime = Math.round(window.performance.now());
		xhr.connect("reqspeed.jpg", "GET", url, aftercontinuousstatic);
	}

	function aftercontinuousstatic(oXML)
	{

		var afterresults1 = document.getElementById("afterresults1");
		var afterresults2 = document.getElementById("afterresults2");
		var realtime1 = document.getElementById("rtping");

		timesample = Math.round(window.performance.now()) - starttime;
		if(timesample < min)
		{
			min = timesample;
			afterresults1.innerHTML = "<span style='color:" + colorof(min) +"'>min:"+min+"ms</span> <br><span style='color:" + colorof(max) +"'>"+"max:"+max+"ms</span>";
		}
		if(timesample > max)
		{
			max = timesample;
			afterresults1.innerHTML = "<span style='color:" + colorof(min) +"'>min:"+min+"ms</span> <br><span style='color:" + colorof(max) +"'>"+"max:"+max+"ms</span>";
		}



		if(counter1 >= 7176 || paused == true)
		{
	
			return 1;
		}
		counter1 += 1;
		total1 += timesample;
		avgpingtime = Math.round(total1/counter1);

		var temp = oXML.responseText;
		temp += "";
		if(temp == "1")
		{

			ctx.fillStyle = colorof(timesample);
			ctx.fillText("!",textX,textY);
			textX += 2;
			if(textX > 596)
			{
				textY += 8;
				textX = 0;
			}
			
			realtime1.innerHTML = "<span style='color:" + colorof(timesample) +"'>"+ timesample + "ms</span>";
			afterresults2.innerHTML = "<span style='color:" + colorof(avgpingtime) +"'>avg: "+ avgpingtime + "ms</span>";

		}
		else
		{
			string1 += ". ";
			realtime1.innerHTML = "timeout";
		}
		var url = "nocache=" + Math.random() ;

		starttime = Math.round(window.performance.now());
		xhr.connect("reqspeed.jpg", "GET", url, aftercontinuousstatic);

	}


	document.write("<br>Recent changes<br>August 28th, 2017:<br>I've changed the way I translate ping times into color. I now smoothly transition from green to red.");

	continuousstatic();

//-->
	</script>



<div id="bottomlink"><br/>Reqspeed - <a href="http://lagbag.com">lagbag</a></div></div>
	
<br>
	This software is released under the <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons BY-NC-SA</a> license.

</body></html>



